
extends ../shared/template
block content
  #taskindex
    h1 Tasks
    table
      thead
        tr
          th Name
          th:!= linkBuilder.sort(query, 'due', 'Due')
          th Photo
          th:!= linkBuilder.sort(query, 'completed', 'Completed')
          th Tags
          th Priority
      tbody
        each task in tasks
          tr(style="background-color:#{task.priority.color}")
            td= task.name
            td #{moment(task.due).format('ll')} (#{moment(task.due).fromNow()})
            td: img(src='#{task.photo}', width='100px', height='100px')
            td
              form(method='post', action='/tasks/#{task._id}/update#{linkBuilder.makeString(query)}')
                != linkBuilder.check(task.isComplete)
                button Update
            td:!= linkBuilder.makeTags(task.tags, query)
            td= task.priority.name
    #pages
      ul
        - var page = 1
        - count = Math.ceil(count/3)
        while count
          li
            a(href="/tasks?page=#{page + ((query.sortBy) ? '&sortBy=' + query.sortBy : '') + ((query.filter) ? '&filter=' + query.filter : '')}") Page #{page}
          - count--
          - page++
